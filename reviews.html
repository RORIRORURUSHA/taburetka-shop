<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taburetka Shop | Отзывы</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Общие стили */
        :root {
            /* Светлая тема */
            --primary: #4a69bd;
            --primary-dark: #1e3799;
            --primary-light: #6a89cc;
            --accent: #f59e0b;
            --accent-dark: #e67e22;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --border: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);
            
            /* Тёмная тема */
            --dark-primary: #6a89cc;
            --dark-primary-dark: #4a69bd;
            --dark-accent: #f6b93b;
            --dark-text: #e2e8f0;
            --dark-text-light: #94a3b8;
            --dark-bg: #0f172a;
            --dark-card-bg: #1e293b;
            --dark-border: rgba(255, 255, 255, 0.1);
            --dark-shadow-color: rgba(0, 0, 0, 0.3);

            /* Общие */
            --radius: 24px;
            --radius-sm: 12px;
            --shadow: 0 12px 32px var(--shadow-color);
            --shadow-hover: 0 20px 40px var(--shadow-color);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            --transition-fast: all 0.2s ease-out;
            --gradient: linear-gradient(135deg, var(--primary), var(--primary-dark));
            --gradient-hover: linear-gradient(135deg, var(--primary-dark), var(--primary));
            --gradient-accent: linear-gradient(135deg, var(--accent), var(--accent-dark));
        }

        /* Тёмная тема */
        .dark-mode {
            --primary: var(--dark-primary);
            --primary-dark: var(--dark-primary-dark);
            --accent: var(--dark-accent);
            --text: var(--dark-text);
            --text-light: var(--dark-text-light);
            --bg: var(--dark-bg);
            --card-bg: var(--dark-card-bg);
            --border: var(--dark-border);
            --shadow-color: var(--dark-shadow-color);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            line-height: 1.5;
            transition: background 0.5s ease, color 0.3s ease;
        }

        /* Шапка */
        .header {
            background: var(--gradient);
            padding: 0.75rem 1rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .logo {
            color: #fff;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.5px;
            white-space: nowrap;
            margin-right: auto;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: #fff;
            border-radius: 10px;
            animation: rotate 25s linear infinite;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-shrink: 0;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition-fast);
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Основное содержимое */
        .main-content {
            flex: 1;
            padding: 1rem;
            padding-bottom: 80px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .product-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
            text-align: center;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .product-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border-radius: var(--radius-sm);
            background: var(--bg);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .product-image:hover {
            transform: scale(1.05);
        }

        .product-title {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-family: 'Montserrat', sans-serif;
        }

        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: clamp(1.5rem, 5vw, 1.8rem);
            font-weight: 800;
            margin: 1.5rem 0 1rem;
            color: var(--primary-dark);
            font-family: 'Montserrat', sans-serif;
            position: relative;
            display: inline-block;
            padding-right: 1rem;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 0;
            width: 60%;
            height: 4px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        /* Форма отзыва */
        .review-form {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out 0.2s both;
            transition: var(--transition);
        }

        .review-form:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition-fast);
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 105, 189, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .rating-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .rating-star {
            font-size: 1.8rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition-fast);
            position: relative;
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        .rating-star.active {
            color: var(--accent);
            animation: starBounce 0.5s ease;
        }

        @keyframes starBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }

        .rating-star::after {
            content: '★';
            position: absolute;
            top: 0;
            left: 0;
            color: var(--accent);
            width: 0;
            overflow: hidden;
            transition: width 0.3s ease;
        }

        .rating-star.active::after {
            width: 100%;
        }

        .file-upload {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            background: rgba(74, 105, 189, 0.1);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px dashed var(--primary);
        }

        .file-label:hover {
            background: rgba(74, 105, 189, 0.2);
            transform: translateY(-2px);
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .file-preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--border);
            animation: fadeIn 0.3s ease-out;
            transition: var(--transition);
        }

        .file-preview-item:hover {
            transform: scale(1.05);
        }

        .file-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .file-preview-remove:hover {
            background: rgba(220, 38, 38, 0.8);
            transform: scale(1.1);
        }

        .submit-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.9rem 1.5rem;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            box-shadow: 0 4px 12px rgba(74, 105, 189, 0.2);
            width: 100%;
            justify-content: center;
        }

        .submit-btn:hover {
            background: var(--gradient-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 105, 189, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Список отзывов */
        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .review-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
            transition: var(--transition);
            opacity: 0;
            transform: translateY(20px);
        }

        .review-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .review-card:hover {
            transform: translateY(-5px) !important;
            box-shadow: var(--shadow-hover);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .review-author {
            font-weight: 700;
            color: var(--primary-dark);
        }

        .review-date {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .review-rating {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .review-rating-star {
            color: var(--accent);
            font-size: 1rem;
            transition: var(--transition-fast);
        }

        .review-rating-star:hover {
            transform: scale(1.2);
        }

        .review-text {
            margin-bottom: 1rem;
            color: var(--text);
            line-height: 1.6;
        }

        .review-images {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .review-image {
            width: 100px;
            height: 100px;
            border-radius: var(--radius-sm);
            object-fit: cover;
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid var(--border);
        }

        .review-image:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .no-reviews {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
            font-style: italic;
            animation: fadeIn 0.6s ease-out;
        }

        /* Навигационная панель */
        .nav-footer {
            background: var(--card-bg);
            padding: 0.5rem;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -4px 20px var(--shadow-color);
            border-radius: var(--radius) var(--radius) 0 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background-color: rgba(30, 41, 59, 0.9);
            border-top: 1px solid var(--border);
        }

        .nav-menu {
            display: flex;
            justify-content: space-around;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-item {
            color: var(--text);
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
            position: relative;
            background: rgba(74, 105, 189, 0.05);
            font-size: 0.75rem;
            font-weight: 600;
            flex-grow: 1;
            max-width: 33%;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            transition: var(--transition-fast);
        }

        .nav-item:hover {
            background: rgba(74, 105, 189, 0.1);
            transform: translateY(-3px);
        }

        .nav-item:hover svg {
            transform: scale(1.1);
        }

        .nav-item.active {
            background: rgba(74, 105, 189, 0.15);
            color: var(--primary-dark);
        }

        .cart-count {
            position: absolute;
            top: -4px;
            right: 4px;
            background: var(--accent);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: var(--transition-fast);
        }

        .nav-item:hover .cart-count {
            transform: scale(1.1);
        }

        /* Модальное окно изображения */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .image-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .image-modal-img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }

        .image-modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: rgba(255,255,255,0.2);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .image-modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        /* Анимации */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        /* Уведомления */
        .notification {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            left: 1rem;
            background: var(--card-bg);
            color: var(--text);
            padding: 0.9rem 1.2rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateY(100%);
            opacity: 0;
            transition: var(--transition);
            z-index: 3000;
            max-width: 100%;
            border-left: 4px solid var(--primary);
        }

        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.error {
            border-left-color: #dc2626;
            background: #fee2e2;
            color: #dc2626;
        }

        .notification.success {
            border-left-color: #10b981;
            background: #d1fae5;
            color: #065f46;
        }

        .notification-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .notification-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Адаптивность */
        @media (min-width: 480px) {
            .notification {
                left: auto;
                right: 1rem;
                max-width: 320px;
            }
            
            .product-header {
                flex-direction: row;
                text-align: left;
                gap: 2rem;
            }
            
            .product-image {
                margin-bottom: 0;
            }
            
            .rating-container {
                justify-content: flex-start;
            }
            
            .submit-btn {
                width: auto;
            }
        }

        @media (min-width: 640px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .review-form {
                padding: 2rem;
            }
        }

        @media (min-width: 768px) {
            .review-images {
                gap: 1rem;
            }
            
            .review-image {
                width: 150px;
                height: 150px;
            }
            
            .file-preview-item {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">TS</div>
                TABURETKA SHOP
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Переключить тему">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" id="sunIcon">
                        <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                    </svg>
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" id="moonIcon" style="display: none;">
                        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1-8.313-12.454z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div id="productInfo" class="product-header fade-in">
            <!-- Информация о товаре будет загружена через JS -->
        </div>

        <h2 class="section-title fade-in delay-1">Оставить отзыв</h2>
        <form id="reviewForm" class="review-form fade-in delay-1">
            <div class="form-group">
                <label for="reviewName" class="form-label">Ваше имя</label>
                <input type="text" id="reviewName" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Оценка</label>
                <div class="rating-container">
                    <span class="rating-star" data-rating="1">★</span>
                    <span class="rating-star" data-rating="2">★</span>
                    <span class="rating-star" data-rating="3">★</span>
                    <span class="rating-star" data-rating="4">★</span>
                    <span class="rating-star" data-rating="5">★</span>
                </div>
                <input type="hidden" id="reviewRating" value="0" required>
            </div>
            
            <div class="form-group">
                <label for="reviewText" class="form-label">Текст отзыва</label>
                <textarea id="reviewText" class="form-textarea" required></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Фотографии (до 3)</label>
                <div class="file-upload">
                    <input type="file" id="reviewImages" class="file-input" accept="image/*" multiple>
                    <label for="reviewImages" class="file-label">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        Добавить фото
                    </label>
                    <div id="filePreview" class="file-preview"></div>
                </div>
            </div>
            
            <button type="submit" class="submit-btn" id="submitBtn">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                Отправить отзыв
            </button>
        </form>

        <h2 class="section-title fade-in delay-2">Отзывы покупателей</h2>
        <div id="reviewsList" class="reviews-list">
            <div class="no-reviews">Отзывов пока нет. Будьте первым!</div>
            <!-- Отзывы будут загружены через JS -->
        </div>
    </main>

    <nav class="nav-footer">
        <div class="nav-menu">
            <a href="index.html" class="nav-item" aria-label="Каталог">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M10 3H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm10 0h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM10 13H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1zm10 0h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1z"/>
                </svg>
                <span>Каталог</span>
            </a>
            <a href="korzina.html" class="nav-item" aria-label="Корзина">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
                </svg>
                <span>Корзина</span>
                <div class="cart-count">0</div>
            </a>
            <a href="o-nas.html" class="nav-item" aria-label="О нас">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                </svg>
                <span>О нас</span>
            </a>
        </div>
    </nav>

    <!-- Модальное окно изображения -->
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <img id="modalImage" class="image-modal-img" src="" alt="Увеличенное изображение">
            <button class="image-modal-close" onclick="closeImageModal()">×</button>
        </div>
    </div>

    <!-- Уведомление -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </div>
        <div class="notification-text" id="notificationText"></div>
    </div>

    <!-- Подключаем Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        // Firebase конфигурация
        const firebaseConfig = {
            apiKey: "AIzaSyClHAAMfkfvhD63Np6aoRG0nLYiz7JQxZI",
            authDomain: "taburetka-shop.firebaseapp.com",
            databaseURL: "https://taburetka-shop-default-rtdb.firebaseio.com",
            projectId: "taburetka-shop",
            storageBucket: "taburetka-shop.appspot.com",
            messagingSenderId: "722686458212",
            appId: "1:722686458212:web:863b3c76a22f67a5b1a271"
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Текущий товар и отзывы
        let currentProduct = null;
        let reviews = [];
        let selectedFiles = [];
        let selectedRating = 0;

        // Корзина
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartCount = document.querySelector('.cart-count');

        function updateCart() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = totalItems > 99 ? '99+' : totalItems;
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Загрузка информации о товаре
        function loadProductInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('productId');
            
            if (!productId) {
                window.location.href = 'index.html';
                return;
            }

            // Ищем товар в локальных данных (в реальном приложении нужно загружать с сервера)
            const allProducts = [
                // Жидкости
                {
                    id: 1,
                    category: "liquids",
                    name: "Злая монашка 7%",
                    description: "Кислые вкусы",
                    image: "images/zhidkost1.jpg",
                    price: 395
                },
                {
                    id: 2,
                    category: "liquids",
                    name: "Дуалл 5%",
                    description: "Фруктовые вкусы",
                    image: "images/duall1.webp",
                    price: 360
                },
                {
                    id: 3,
                    category: "liquids",
                    name: "Trava 5%",
                    description: "Освежающие вкусы",
                    image: "images/trava.jpg",
                    price: 370
                },
                {
                    id: 4,
                    category: "liquids",
                    name: "Dabler 2%",
                    description: "Легкие вкусы",
                    image: "images/dabbler.jpg",
                    price: 350
                },
                {
                    id: 5,
                    category: "liquids",
                    name: "Chapman 5%",
                    description: "Табачные вкусы",
                    image: "images/Chapman.jpg",
                    price: 360
                },
                {
                    id: 6,
                    category: "liquids",
                    name: "XYLINET TEBE PIZDA 30ML 7%",
                    description: "16 вкусов",
                    image: "images/хулинет.jpg",
                    price: 380
                },
                {
                    id: 20,
                    category: "liquids",
                    name: "Anima love 2%",
                    description: "2 вкуса",
                    image: "images/анима_лав2.jpg",
                    price: 430
                },
                // Подсистемы
                {
                    id: 8,
                    category: "pods",
                    name: "XROS mini",
                    description: "Компактная подсистема",
                    image: "images/хмини.jpg",
                    price: 1500
                },
                {
                    id: 9,
                    category: "pods",
                    name: "XROS 4",
                    description: "Новая версия с регулировкой",
                    image: "images/х4.jpg",
                    price: 2700
                },
                {
                    id: 10,
                    category: "pods",
                    name: "XROS 4 mini",
                    description: "Компактная версия XROS 4",
                    image: "images/х4мини.jpg",
                    price: 2350
                },
                {
                    id: 11,
                    category: "pods",
                    name: "XROS pro",
                    description: "Профессиональная подсистема",
                    image: "images/хпро.jpg",
                    price: 3000
                },
                {
                    id: 17,
                    category: "pods",
                    name: "Aegis hero",
                    description: "Прочная подсистема",
                    image: "images/хиро1.jpg",
                    price: 2850
                },
                {
                    id: 18,
                    category: "pods",
                    name: "Aegis h45",
                    description: "Мощная подсистема",
                    image: "images/хиро2.jpg",
                    price: 3100
                },
                {
                    id: 19,
                    category: "pods",
                    name: "Aegis h45 classic",
                    description: "Классическая версия",
                    image: "images/хиро3.jpg",
                    price: 3000
                }
            ];

            currentProduct = allProducts.find(p => p.id == productId);
            
            if (!currentProduct) {
                window.location.href = 'index.html';
                return;
            }

            // Отображаем информацию о товаре
            const productInfo = document.getElementById('productInfo');
            productInfo.innerHTML = `
                <img src="${currentProduct.image}" alt="${currentProduct.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300?text=No+Image'">
                <div>
                    <h1 class="product-title">${currentProduct.name}</h1>
                    <p class="product-category">${currentProduct.description}</p>
                    <div class="product-price">${currentProduct.price} ₽</div>
                </div>
            `;

            // Загружаем отзывы для этого товара
            loadReviews();
        }

        // Загрузка отзывов из Firebase
        function loadReviews() {
            const reviewsRef = database.ref('reviews').orderByChild('productId').equalTo(parseInt(currentProduct.id));
            
            reviewsRef.on('value', (snapshot) => {
                reviews = [];
                const data = snapshot.val();
                
                if (data) {
                    reviews = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    
                    // Сортируем отзывы по дате (новые сначала)
                    reviews.sort((a, b) => new Date(b.date) - new Date(a.date));
                }
                
                renderReviews();
            });
        }

        // Отображение отзывов с анимациями
        function renderReviews() {
            const reviewsList = document.getElementById('reviewsList');
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = '<div class="no-reviews">Отзывов пока нет. Будьте первым!</div>';
                return;
            }

            reviewsList.innerHTML = '';
            
            reviews.forEach((review, index) => {
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                reviewCard.innerHTML = `
                    <div class="review-header">
                        <div class="review-author">${review.author}</div>
                        <div class="review-date">${formatDate(review.date)}</div>
                    </div>
                    <div class="review-rating">
                        ${'★'.repeat(review.rating).split('').map(() => `<span class="review-rating-star">★</span>`).join('')}
                    </div>
                    <div class="review-text">${review.text}</div>
                    ${review.images && review.images.length > 0 ? `
                        <div class="review-images">
                            ${review.images.map(img => `<img src="${img}" class="review-image" onclick="openImageModal('${img}')">`).join('')}
                        </div>
                    ` : ''}
                `;
                
                reviewsList.appendChild(reviewCard);
                
                // Добавляем анимацию появления с задержкой
                setTimeout(() => {
                    reviewCard.classList.add('visible');
                }, index * 100);
            });
        }

        // Форматирование даты
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }

        // Открытие модального окна с изображением
        function openImageModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Закрытие модального окна с изображением
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Показать уведомление
        function showNotification(text, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.className = `notification ${type}`;
            
            // Отменяем предыдущее уведомление, если оно было
            clearTimeout(notification.timeoutId);
            
            notification.classList.remove('active');
            setTimeout(() => {
                notification.classList.add('active');
            }, 10);
            
            notification.timeoutId = setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        // Переключение темы
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('sunIcon').style.display = isDark ? 'none' : 'block';
            document.getElementById('moonIcon').style.display = isDark ? 'block' : 'none';
        }

        // Загрузка изображений в Firebase Storage
        async function uploadImages(files) {
            const uploadPromises = [];
            
            for (let i = 0; i < Math.min(files.length, 3); i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                const storageRef = storage.ref(`reviews/${Date.now()}_${file.name}`);
                const uploadTask = storageRef.put(file);
                
                uploadPromises.push(
                    new Promise((resolve, reject) => {
                        uploadTask.on(
                            'state_changed',
                            null,
                            (error) => {
                                console.error('Ошибка загрузки изображения:', error);
                                reject(error);
                            },
                            async () => {
                                try {
                                    const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                                    resolve(downloadURL);
                                } catch (error) {
                                    console.error('Ошибка получения URL изображения:', error);
                                    reject(error);
                                }
                            }
                        );
                    })
                );
            }
            
            return Promise.all(uploadPromises);
        }

        // Инициализация обработчиков событий
        function initEventHandlers() {
            // Обработчик звезд рейтинга
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    selectedRating = rating;
                    document.getElementById('reviewRating').value = rating;
                    
                    stars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
                
                // Анимация при наведении
                star.addEventListener('mouseenter', function() {
                    const hoverRating = parseInt(this.dataset.rating);
                    stars.forEach((s, i) => {
                        if (i < hoverRating && !s.classList.contains('active')) {
                            s.style.transform = 'scale(1.2)';
                        }
                    });
                });
                
                star.addEventListener('mouseleave', function() {
                    stars.forEach((s, i) => {
                        if (!s.classList.contains('active')) {
                            s.style.transform = 'scale(1)';
                        }
                    });
                });
            });

            // Обработчик загрузки файлов
            document.getElementById('reviewImages').addEventListener('change', function(e) {
                const files = e.target.files;
                const filePreview = document.getElementById('filePreview');
                filePreview.innerHTML = '';
                selectedFiles = [];
                
                if (files.length > 3) {
                    showNotification('Можно загрузить не более 3 фотографий', 'error');
                    this.value = '';
                    return;
                }
                
                for (let i = 0; i < Math.min(files.length, 3); i++) {
                    const file = files[i];
                    if (!file.type.match('image.*')) continue;
                    
                    selectedFiles.push(file);
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'file-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" class="file-preview-img">
                            <span class="file-preview-remove" data-index="${i}">×</span>
                        `;
                        filePreview.appendChild(previewItem);
                        
                        // Обработчик удаления превью
                        previewItem.querySelector('.file-preview-remove').addEventListener('click', function(e) {
                            e.stopPropagation();
                            const index = parseInt(this.dataset.index);
                            selectedFiles.splice(index, 1);
                            filePreview.removeChild(previewItem);
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Обработчик формы отзыва
            document.getElementById('reviewForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('reviewName').value.trim();
                const rating = parseInt(document.getElementById('reviewRating').value);
                const text = document.getElementById('reviewText').value.trim();
                
                if (!name || !rating || !text) {
                    showNotification('Заполните все обязательные поля', 'error');
                    return;
                }
                
                // Блокируем кнопку отправки
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" class="loading-spinner">
                        <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/>
                    </svg>
                    Отправка...
                `;
                
                try {
                    // Загружаем изображения, если они есть
                    let imageUrls = [];
                    if (selectedFiles.length > 0) {
                        try {
                            imageUrls = await uploadImages(selectedFiles);
                            console.log('Изображения успешно загружены:', imageUrls);
                        } catch (error) {
                            console.error('Ошибка загрузки изображений:', error);
                            showNotification('Ошибка загрузки изображений', 'error');
                            throw error;
                        }
                    }
                    
                    // Создаем новый отзыв
                    const newReview = {
                        productId: parseInt(currentProduct.id),
                        author: name,
                        rating: rating,
                        text: text,
                        images: imageUrls,
                        date: new Date().toISOString()
                    };
                    
                    console.log('Отправка отзыва:', newReview);
                    
                    // Сохраняем отзыв в Firebase
                    const newReviewRef = database.ref('reviews').push();
                    await newReviewRef.set(newReview);
                    console.log('Отзыв успешно сохранен');
                    
                    // Очищаем форму
                    this.reset();
                    selectedRating = 0;
                    selectedFiles = [];
                    document.getElementById('filePreview').innerHTML = '';
                    document.querySelectorAll('.rating-star').forEach(star => star.classList.remove('active'));
                    
                    showNotification('Спасибо за ваш отзыв!', 'success');
                    
                    // Прокручиваем к новому отзыву
                    setTimeout(() => {
                        document.getElementById('reviewsList').scrollIntoView({ behavior: 'smooth' });
                    }, 500);
                    
                } catch (error) {
                    console.error('Ошибка при отправке отзыва:', error);
                    showNotification('Произошла ошибка при отправке отзыва', 'error');
                } finally {
                    // Разблокируем кнопку
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        Отправить отзыв
                    `;
                }
            });

            // Обработчик переключения темы
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Проверяем сохранённую тему
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            updateThemeIcon();

            updateCart();
            loadProductInfo();
            initEventHandlers();
        });

        // Глобальные функции для вызова из HTML
        window.openImageModal = openImageModal;
        window.closeImageModal = closeImageModal;
    </script>
</body>
</html>
